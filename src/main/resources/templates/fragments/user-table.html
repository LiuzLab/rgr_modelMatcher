<!DOCTYPE html>
<!--suppress ThymeleafVariablesResolveInspection java variables not visible in fragments-->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security4">
<body>
<!-- User table -->
<table class="user-table table table-sm mb-0" th:fragment="user-table (users, remote)">
    <thead class="thead-light">
    <tr>
        <th></th>
        <th th:if="${remote}" scope="col">Origin</th>
        <th scope="col">Email</th>
        <th scope="col">Full Name</th>
        <th th:unless="${@applicationSettings.profile.enabledResearcherPositions.isEmpty()}" scope="col">Position</th>
        <th scope="col">Organization</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="u : ${users}">
        <th:block sec:authorize="hasPermission(#vars.u, 'read')">
            <td class="text-center">
                <a th:href="@{/userView/{id}(id=${u.id})}" class="btn btn-primary btn-sm">View user profile</a>
            </td>
            <td th:if="${remote}" th:text="${u.origin}"></td>
            <td><a th:href="'mailto:' + ${u.email}" th:text="${u.email}"></a></td>
            <td th:text="${u.profile.fullName}"></td>
            <td th:unless="${@applicationSettings.profile.enabledResearcherPositions.isEmpty()}">
                <span th:if="${u.profile.researcherPosition != null}" th:text="${u.profile.researcherPosition.label}"></span>
            </td>
            <td th:text="${u.profile.organization}"></td>
        </th:block>
        <th:block sec:authorize="!hasPermission(#vars.u, 'read')">
            <td class="text-center">
                <a th:href="@{/request-match/user/{hiddenId}(hiddenId=${@userService.getHiddenIdForUser(u)})}"
                   class="btn btn-primary btn-sm">Request a match</a>
            </td>
            <td class="text-center" th:colspan="100">
                <i class="oi oi-lock-locked" title="This researcher information is confidential."></i>
                This research information is confidential.
            </td>
        </th:block>
    </tr>
    <tr th:if="${#lists.isEmpty(users)}">
        <td class="text-center" th:colspan="100">No Users Found</td>
    </tr>
    </tbody>
</table>

<table class="user-table table table-sm mb-0" th:fragment="usergenes-table (usergenes, remote)">
    <tr th:each="map : ${mapsList}" >
        <td colspan="100" th:each="mapEntry : ${map}">
            <span th:text="${mapEntry.key}"></span>
            <span th:text="${mapEntry.value}"></span>
        </td>
    </tr>

    <!-- User genes -->
    <thead class="thead-light">
    <tr>
        <th scope="col"></th>
        <th th:if="${remote}" scope="col">Origin</th>
        <th scope="col">Email</th>
        <th scope="col">Full Name</th>
        <th th:unless="${@applicationSettings.profile.enabledResearcherPositions.isEmpty()}" scope="col">Position</th>
        <th scope="col">Organization</th>
        <th scope="col">Gene</th>
        <th scope="col">Tier</th>
        <th scope="col">Organism</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="ug : ${usergenes}">
        <th:block sec:authorize="hasPermission(#vars.ug, 'read')">
            <td class="text-center">
                <a th:href="@{/userView/{id}(id=${ug.user.id})}" class="btn btn-primary btn-sm">View User Profile</a>
            </td>
            <td th:if="${remote}"><span th:text="${ug.user.origin}" th:remove="tag"></span></td>
            <td><a th:href="'mailto:' + ${ug.user.email}" th:text="${ug.user.email}"></a></td>
            <td th:text="${ug.user.profile.fullName}"></td>
            <td th:unless="${@applicationSettings.profile.enabledResearcherPositions.isEmpty()}">
                <span th:if="${ug.user.profile.researcherPosition} != null"
                      th:text="${ug.user.profile.researcherPosition.label}"></span>
            </td>
            <td th:text="${ug.user.profile.organization}"></td>
        </th:block>
        <th:block sec:authorize="!hasPermission(#vars.ug, 'read')">
            <td class="text-center">
                <a th:href="@{/request-match/user/{hiddenId}/gene/{hiddenUserGeneId}(hiddenId=${@userService.getHiddenIdForUser(ug.user)},hiddenUserGeneId=${@userGeneService.getHiddenIdForUserGene(ug)})}" class="btn btn-primary btn-sm">Request a match</a>
            </td>
            <td class="text-center" colspan="100">
                <i class="oi oi-lock-locked" title="This researcher information is confidential."></i>
                This research information is confidential.
            </td>
        </th:block>
        <td th:text="${ug.symbol}"></td>
        <td th:text="${ug.tier}"></td>
        <td th:text="${#strings.capitalizeWords(ug.taxon.commonName)}"></td>
    </tr>
    <tr th:if="${#lists.isEmpty(usergenes)}">
        <td class="text-center" th:colspan="100">No Users Found</td>
    </tr>
    </tbody>
</table>
</body>
</html>